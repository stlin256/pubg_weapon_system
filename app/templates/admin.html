<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - PUBG æ­¦å™¨ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <style>
        /* --- CSS å˜é‡ --- */
        :root {
            --orange: #f2a900;
            --dark-bg: #0f1014;
            --panel-bg: #1e2126;
            --border-color: #383b42;
            --text-main: #e2e8f0;
            --text-muted: #718096;
            --danger: #e84118;
            --success: #4cd137;
            --blue: #3182ce;
            --purple: #9b59b6;
            --code-bg: #0a0b0e;
        }

        /* --- å…¨å±€æ ·å¼ --- */
        * { box-sizing: border-box; outline: none; }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
            margin: 0; padding: 2rem;
            min-height: 100vh; /* æ”¹ä¸ºæœ€å°é«˜åº¦ï¼Œå†…å®¹å¤šæ—¶è‡ªåŠ¨æ’‘å¼€ */
            overflow-y: auto;  /* å…è®¸å‚ç›´æ»šåŠ¨ */
            overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»šåŠ¨ */
            display: flex; flex-direction: column;
            background-image: radial-gradient(circle at top right, #1f2329 0%, transparent 40%);
        }

        /* --- æ»šåŠ¨æ¡ç¾åŒ– --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0f1014; }
        ::-webkit-scrollbar-thumb { background: #383b42; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--orange); }

        /* --- å¤´éƒ¨åŒºåŸŸ --- */
        .admin-header {
            flex-shrink: 0; /* é˜²æ­¢å¤´éƒ¨è¢«å‹ç¼© */
            display: flex; justify-content: space-between; align-items: flex-end;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem; margin-bottom: 1.5rem;
            position: relative;
        }
        .admin-header::after {
            content: ''; position: absolute; bottom: -2px; left: 0; width: 120px; height: 2px;
            background: var(--orange); box-shadow: 0 0 10px var(--orange);
        }
        .header-title h1 {
            font-family: 'Oswald', sans-serif; margin: 0; font-size: 2rem;
            text-transform: uppercase; letter-spacing: 2px; color: #fff;
        }
        .header-subtitle {
            font-family: 'Roboto Mono', monospace; font-size: 0.8rem; color: var(--orange);
            letter-spacing: 1px; margin-top: 5px; opacity: 0.8;
        }

        /* --- æŒ‰é’®æ ·å¼ --- */
        .btn {
            padding: 0.6rem 1.2rem; border-radius: 2px; cursor: pointer; border: 1px solid transparent;
            font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 1px;
            font-size: 0.9rem; transition: all 0.2s; font-weight: 600; background: #2d3748; color: #fff;
        }
        .btn:hover { border-color: var(--orange); color: var(--orange); background: transparent; }
        .btn-danger { background-color: rgba(232, 65, 24, 0.1); border: 1px solid var(--danger); color: var(--danger); }
        .btn-danger:hover { background-color: var(--danger); color: white; }
        .btn-primary { background-color: var(--orange); color: #000; border: none; }
        .btn-primary:hover { background-color: #ffc107; color: #000; transform: translateY(-1px); }
        .btn-sm { font-size: 0.8rem; padding: 0.4rem 0.8rem; }

        /* --- é¡¶éƒ¨ç»Ÿè®¡ (å›ºå®šé«˜åº¦) --- */
        .stats-container {
            flex-shrink: 0; /* é˜²æ­¢å‹ç¼© */
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* --- ä¸»å¸ƒå±€ (æ ¸å¿ƒä¿®å¤ï¼šå¡«æ»¡å‰©ä½™ç©ºé—´) --- */
        .main-layout {
            flex: 1; /* å æ®å‰©ä½™æ‰€æœ‰é«˜åº¦ */
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 1.5rem;
            min-height: 600px; /* å…³é”®ï¼šå…è®¸ Flex/Grid å­é¡¹å°äºå†…å®¹é«˜åº¦ï¼Œä»è€Œè§¦å‘æ»šåŠ¨æ¡ */
            padding-bottom: 2rem; /* åº•éƒ¨ç•™ç™½ */
        }

        /* å·¦ä¾§è¾¹æ  */
        .sidebar {
            display: flex; flex-direction: column; gap: 1.5rem;
            overflow: hidden; /* é˜²æ­¢ä¾§è¾¹æ æ’‘å¼€é¡µé¢ */
        }

        /* å³ä¾§æ—¥å¿—åŒº (æ ¸å¿ƒä¿®å¤) */
        .log-section {
            height: auto;
            min-height: 100%;
            display: flex; flex-direction: column;
            overflow: hidden; /* ç¡®ä¿å†…å®¹ä¸æº¢å‡º */
        }
        .log-section .card { 
            flex: 1; 
            display: flex; flex-direction: column; 
            height: 100%; /* å¼ºåˆ¶å æ»¡ */
        } 
        .log-section .card-body { 
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            display: flex; flex-direction: column; 
            padding: 0; 
            overflow: hidden; /* å…³é”®ï¼šéšè—æº¢å‡ºï¼ŒæŠŠæ»šåŠ¨æƒäº¤ç»™å†…éƒ¨çš„ log-viewer */
            position: relative;
        }
        #log-viewer { 
            position: absolute; /* ç»å¯¹å®šä½å¡«æ»¡å®¹å™¨ */
            top: 0; left: 0; right: 0; bottom: 0;
            overflow-y: auto; /* å†…éƒ¨æ»šåŠ¨ */
            border: none; 
        }

        /* --- å¡ç‰‡é€šç”¨æ ·å¼ --- */
        .card {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            display: flex; flex-direction: column;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .card-header {
            padding: 1rem 1.2rem;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid var(--border-color);
            font-family: 'Oswald', sans-serif; font-size: 1.1rem; letter-spacing: 1px;
            color: var(--text-muted);
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .card-body { padding: 1.2rem; }

        /* --- ç»Ÿè®¡å¡ç‰‡æ ·å¼ --- */
        .stat-card {
            background: linear-gradient(135deg, var(--panel-bg) 0%, rgba(30,33,38,0.8) 100%);
            border: 1px solid var(--border-color);
            padding: 1.5rem; border-radius: 4px;
            display: flex; align-items: center; justify-content: space-between;
            position: relative; overflow: hidden;
        }
        .stat-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--orange); }
        .stat-info h3 { margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; }
        .stat-info p { margin: 0; font-size: 2.2rem; font-family: 'Oswald', sans-serif; color: #fff; line-height: 1; }
        .stat-icon { font-size: 2.5rem; opacity: 0.1; position: absolute; right: 20px; color: #fff; }

        /* --- ä¾§è¾¹æ å†…å®¹æ ·å¼ --- */
        .action-group { margin-bottom: 1.5rem; }
        .action-group label { display: block; margin-bottom: 0.6rem; font-size: 0.85rem; color: var(--text-muted); font-weight: bold; }
        .btn-group { display: flex; gap: 0.5rem; }
        .btn-group .btn { flex: 1; text-align: center; }
        .btn-group .btn.active { background: var(--blue); color: white; border-color: var(--blue); }

        #user-list { list-style: none; padding: 0; margin: 0; max-height: 400px; overflow-y: auto; }
        #user-list li {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05);
            font-family: 'Roboto Mono', monospace; font-size: 0.9rem;
        }
        #user-list li:last-child { border-bottom: none; }
        #user-list li:hover { background: rgba(255,255,255,0.02); }

        /* --- æ—¥å¿—æŸ¥çœ‹å™¨æ ·å¼ --- */
        #log-viewer {
            background: var(--code-bg);
            padding: 1rem;
            font-family: 'Roboto Mono', monospace; font-size: 0.85rem; line-height: 1.6;
            color: #d4d4d4;
        }
        .log-line {
            margin-bottom: 0.8rem; padding-bottom: 0.8rem;
            border-bottom: 1px dashed #2d3748; word-wrap: break-word;
        }
        .log-meta { display: flex; align-items: center; margin-bottom: 4px; gap: 8px; font-size: 0.75rem; color: #666; }
        
        .tag { padding: 1px 6px; border-radius: 2px; font-weight: bold; font-size: 0.7rem; text-transform: uppercase; }
        .tag.success { background: rgba(46, 204, 113, 0.2); color: #2ecc71; border: 1px solid rgba(46, 204, 113, 0.3); }
        .tag.error { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid rgba(231, 76, 60, 0.3); }
        .tag.info { background: rgba(52, 152, 219, 0.2); color: #3498db; border: 1px solid rgba(52, 152, 219, 0.3); }
        
        .highlight-key { color: var(--purple); font-weight: bold; margin-left: 5px; }
        .highlight-val { color: var(--text-main); }
        .highlight-val.accent { color: var(--orange); }
        .highlight-val.path { color: #569cd6; }
        .highlight-block {
            display: block; margin-top: 4px; margin-left: 20px;
            color: #a0aec0; border-left: 2px solid #333; padding-left: 10px;
        }

        /* --- å¼¹çª—æ ·å¼ (ä¿®å¤æ¢è¡Œé—®é¢˜) --- */
        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #1e2126; margin: 15% auto; padding: 2.5rem;
            border: 1px solid var(--border-color); width: 90%; max-width: 500px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--orange);
        }
        
        /* å¼¹çª—æ–‡æœ¬ä¼˜åŒ– */
        .modal-text {
            font-family: 'Oswald', sans-serif; 
            font-size: 1.2rem; 
            color: #fff;
            margin-bottom: 2rem; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            line-height: 1.6;
        }
        .highlight-user {
            display: block; /* å¼ºåˆ¶æ¢è¡Œæ˜¾ç¤ºç”¨æˆ·å */
            font-size: 1.8rem;
            color: var(--danger);
            margin: 10px 0;
            word-break: break-all; /* é˜²æ­¢è¶…é•¿åå­—æ’‘ç ´å¸ƒå±€ */
        }
        
        .confirm-actions { display: flex; justify-content: center; gap: 1rem; }
        .modal .btn { width: 120px; padding: 10px; }
        .modal .btn-confirm { background-color: var(--danger); color: white; border: 1px solid var(--danger); }
        .modal .btn-confirm:hover { background-color: #c0392b; }
        .modal .btn-cancel { background-color: #4a5568; color: white; }
        .modal .btn-cancel:hover { background-color: #2d3748; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- å“åº”å¼ --- */
        @media (max-width: 1024px) {
            body { height: auto; overflow: auto; } /* å¹³æ¿ä»¥ä¸‹æ¢å¤æ»šåŠ¨ */
            .main-layout { grid-template-columns: 1fr; height: auto; }
            .log-section { height: 600px; }
            #log-viewer { position: relative; height: 100%; } /* æ¢å¤ç›¸å¯¹å®šä½ */
        }
        @media (max-width: 768px) {
            .stats-container { grid-template-columns: 1fr; }
            .admin-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
        }
        .version-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-family: 'Roboto Mono', monospace;
            font-size: 12px;
            color: rgba(255,255,255,0.3);
            pointer-events: none;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <div class="admin-header">
        <div class="header-title">
            <div class="header-subtitle">PUBG WEAPON SYSTEM // ADMIN TERMINAL</div>
            <h1>ç®¡ç†æ§åˆ¶å°</h1>
        </div>
        <button id="logoutBtn" class="btn btn-danger">é€€å‡ºç™»å½•</button>
    </div>

    <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-info">
                <h3>æ³¨å†Œç”¨æˆ·</h3>
                <p id="stat-users">--</p>
            </div>
            <div class="stat-icon">ğŸ‘¥</div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3>æ€»è¯†åˆ«æ¬¡æ•°</h3>
                <p id="stat-predictions">--</p>
            </div>
            <div class="stat-icon">ğŸ¯</div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <h3>æ¨¡å‹ç¼“å­˜</h3>
                <p id="stat-cache">--</p>
            </div>
            <div class="stat-icon">ğŸ’¾</div>
        </div>
    </div>

    <!-- ä¸»å¸ƒå±€ -->
    <div class="main-layout">
        
        <!-- å·¦ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="card">
                <div class="card-header">ç³»ç»Ÿç»´æŠ¤</div>
                <div class="card-body">
                    <div class="action-group">
                        <label>ç¼“å­˜æ¸…ç†</label>
                        <button id="clearCacheBtn" class="btn btn-danger" style="width: 100%">æ¸…ç†æ‰€æœ‰æ¨¡å‹ç¼“å­˜</button>
                    </div>
                    <div class="action-group">
                        <label>ç¼“å­˜ç­–ç•¥é…ç½®</label>
                        <div id="cache-strategy-group" class="btn-group">
                            <button class="btn btn-sm" data-strategy="all">å…¨éƒ¨ç¼“å­˜</button>
                            <button class="btn btn-sm" data-strategy="selected">æŒ‰éœ€åŠ è½½</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="flex: 1;">
                <div class="card-header">ç”¨æˆ·åˆ—è¡¨</div>
                <div class="card-body" style="padding: 0;">
                    <ul id="user-list">
                        <!-- JS å¡«å…… -->
                    </ul>
                </div>
            </div>
        </aside>

        <!-- å³ä¾§æ—¥å¿—åŒº -->
        <section class="log-section">
            <div class="card">
                <div class="card-header">
                    <span>è¯†åˆ«æ—¥å¿— / LOGS</span>
                    <span style="font-size: 0.8rem; color: #4cd137;">â— LIVE</span>
                </div>
                <div class="card-body">
                    <div id="log-viewer">
                        <!-- JS å¡«å…… -->
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ç¡®è®¤å¼¹çª— -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <!-- å†…å®¹ç”± JS åŠ¨æ€ç”Ÿæˆ HTML å¡«å……ï¼Œè§£å†³æ ·å¼é—®é¢˜ -->
            <div id="confirmText" class="modal-text"></div>
            <div class="confirm-actions">
                <button id="btnConfirm" class="btn btn-confirm">ç¡®è®¤</button>
                <button id="btnCancel" class="btn btn-cancel">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const adminUser = localStorage.getItem('adminUser');
            const adminPass = localStorage.getItem('adminPass');

            if (!adminUser || !adminPass) {
                window.location.href = '/login';
                return;
            }

            const headers = {
                'X-Username': adminUser,
                'X-Password': adminPass
            };

            const fetchStats = async () => {
                try {
                    const res = await fetch('/api/admin/stats', { headers });
                    if(res.ok) {
                        const data = await res.json();
                        document.getElementById('stat-users').textContent = data.num_users;
                        document.getElementById('stat-predictions').textContent = data.num_predictions;
                        document.getElementById('stat-cache').textContent = data.cache_size;
                    }
                } catch(e) { console.error("Stats error", e); }
            };

            const fetchUsers = async () => {
                try {
                    const res = await fetch('/api/admin/users', { headers });
                    if(res.ok) {
                        const users = await res.json();
                        const userList = document.getElementById('user-list');
                        userList.innerHTML = '';
                        users.forEach(user => {
                            const li = document.createElement('li');
                            li.innerHTML = `
                                <span style="color: var(--orange)">${user}</span>
                                <button class="btn btn-danger btn-sm" data-user="${user}">åˆ é™¤</button>
                            `;
                            userList.appendChild(li);
                        });
                    }
                } catch(e) { console.error("User error", e); }
            };

            const fetchLogs = async () => {
                try {
                    const res = await fetch('/api/admin/logs', { headers });
                    if(res.ok) {
                        const logs = await res.json();
                        const logViewer = document.getElementById('log-viewer');
                        
                        // æ£€æµ‹æ˜¯å¦æ¥è¿‘åº•éƒ¨ï¼Œç”¨äºå†³å®šæ˜¯å¦è‡ªåŠ¨æ»šåŠ¨
                        const isScrolledToBottom = logViewer.scrollHeight - logViewer.clientHeight <= logViewer.scrollTop + 50;

                        logViewer.innerHTML = ''; 

                        logs.forEach(line => {
                            const logLine = document.createElement('div');
                            logLine.className = 'log-line';
                            
                            let metaHtml = '';
                            let contentHtml = line;
                            
                            const timeMatch = line.match(/^(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2},\d{3})/);
                            const levelMatch = line.match(/\[(INFO|ERROR|WARN)\]/);

                            if (timeMatch && levelMatch) {
                                const time = timeMatch[0];
                                const level = levelMatch[1];
                                let levelClass = level === 'ERROR' ? 'error' : (level === 'WARN' ? 'info' : 'success');
                                
                                metaHtml = `<div class="log-meta">
                                    <span style="color: #555;">${time}</span>
                                    <span class="tag ${levelClass}">${level}</span>
                                </div>`;
                                contentHtml = line.substring(timeMatch[0].length + levelMatch[0].length + 3); 
                            } else {
                                metaHtml = `<div class="log-meta"><span class="tag info">LOG</span></div>`;
                            }

                            if (contentHtml.includes('SUCCESS')) contentHtml = contentHtml.replace('SUCCESS', '<span class="tag success">SUCCESS</span>');
                            if (contentHtml.includes('FAILED')) contentHtml = contentHtml.replace('FAILED', '<span class="tag error">FAILED</span>');

                            contentHtml = contentHtml.replace(/User:\s*(\w+)/g, `<span class="highlight-key">User:</span> <span class="highlight-val accent">$1</span>`);
                            contentHtml = contentHtml.replace(/File:\s*([^\s|]+)/g, `<span class="highlight-key">File:</span> <span class="highlight-val path">$1</span>`);
                            
                            contentHtml = contentHtml.replace(/Models:\s*(.+?)(\||$)/g, (match, p1, p2) => {
                                let detailed = p1.replace(/(\w+):/g, '<span style="color:#a0aec0;">$1:</span>');
                                return `<div class="highlight-block"><span style="color:var(--purple);">Models:</span> ${detailed}</div>${p2}`;
                            });
                            contentHtml = contentHtml.replace(/Results:\s*(.+?)(\||$)/g, (match, p1, p2) => {
                                let detailed = p1.replace(/(\w+):/g, '<span style="color:#a0aec0;">$1:</span>');
                                return `<div class="highlight-block"><span style="color:var(--orange);">Results:</span> ${detailed}</div>${p2}`;
                            });
                            contentHtml = contentHtml.replace(/Duration:\s*([\d\.]+[sm])/g, `<span class="highlight-key">Duration:</span> <span class="highlight-val accent">$1</span>`);

                            logLine.innerHTML = metaHtml + contentHtml;
                            logViewer.appendChild(logLine);
                        });

                        if (isScrolledToBottom) {
                            logViewer.scrollTop = logViewer.scrollHeight;
                        }
                    }
                } catch(e) { console.error("Log error", e); }
            };
            
            // å¼¹çª—é€»è¾‘
            const confirmModal = document.getElementById('confirmModal');
            let confirmCallback = null;

            // æ”¯æŒä¼ å…¥ HTML å­—ç¬¦ä¸²æ¥å®ç°æ ·å¼æ§åˆ¶
            const showConfirm = (htmlContent, callback) => {
                document.getElementById('confirmText').innerHTML = htmlContent;
                confirmCallback = callback;
                confirmModal.style.display = 'block';
            };
            const hideConfirm = () => {
                confirmModal.style.display = 'none';
                confirmCallback = null;
            };
            document.getElementById('btnConfirm').addEventListener('click', () => {
                if (confirmCallback) confirmCallback();
                hideConfirm();
            });
            document.getElementById('btnCancel').addEventListener('click', hideConfirm);
            
            document.getElementById('clearCacheBtn').addEventListener('click', () => {
                showConfirm('è­¦å‘Šï¼šç¡®è®¤è¦æ¸…ç†æ‰€æœ‰å·²åŠ è½½çš„æ¨¡å‹ç¼“å­˜å—ï¼Ÿ<br><span style="font-size:0.9rem;color:#718096;display:block;margin-top:10px">è¿™å°†å¯¼è‡´ä¸‹æ¬¡è¯·æ±‚å˜æ…¢ã€‚</span>', async () => {
                    try {
                        await fetch('/api/admin/clear_cache', { method: 'POST', headers });
                        fetchStats();
                    } catch(e) { alert('æ“ä½œå¤±è´¥'); }
                });
            });

            const updateCacheStrategyButtons = (strategy) => {
                const btns = document.querySelectorAll('#cache-strategy-group button');
                btns.forEach(b => {
                    b.classList.toggle('active', b.dataset.strategy === strategy);
                });
            };

            const fetchCacheStrategy = async () => {
                try {
                    const res = await fetch('/api/admin/cache_strategy', { headers });
                    if (res.ok) {
                        const data = await res.json();
                        updateCacheStrategyButtons(data.strategy);
                    }
                } catch (e) { console.error("Cache strategy error", e); }
            };

            document.getElementById('cache-strategy-group').addEventListener('click', async (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const strategy = e.target.dataset.strategy;
                    try {
                        const res = await fetch('/api/admin/cache_strategy', {
                            method: 'POST',
                            headers: { ...headers, 'Content-Type': 'application/json' },
                            body: JSON.stringify({ strategy })
                        });
                        if (res.ok) {
                            const data = await res.json();
                            updateCacheStrategyButtons(data.strategy);
                        }
                    } catch(e) { alert('ç­–ç•¥æ›´æ–°å¤±è´¥'); }
                }
            });

            document.getElementById('user-list').addEventListener('click', async (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const username = e.target.dataset.user;
                    // ä½¿ç”¨ HTML æ ¼å¼åŒ–å¼¹çª—å†…å®¹
                    showConfirm(`å±é™©æ“ä½œï¼šç¡®è®¤è¦æ°¸ä¹…åˆ é™¤ä»¥ä¸‹ç”¨æˆ·å—ï¼Ÿ<br><span class="highlight-user">${username}`, async () => {
                        try {
                            await fetch(`/api/admin/users/${username}`, { method: 'DELETE', headers });
                            fetchUsers();
                            fetchStats();
                        } catch(e) { alert('åˆ é™¤å¤±è´¥'); }
                    });
                }
            });

            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.removeItem('adminUser');
                localStorage.removeItem('adminPass');
                window.location.href = '/login';
            });

            fetchStats();
            fetchUsers();
            fetchLogs();
            fetchCacheStrategy();
            setInterval(fetchLogs, 3000);
            setInterval(fetchStats, 10000);
            setInterval(fetchUsers, 10000);
        });
    </script>
    <div class="version-indicator">{{ version }}</div>
</body>
</html>